<html>
    <head>
    </head>
    <body>
        <div id="1234"></div>
        <script src="https://threejs.org/build/three.js"></script>
        <script>

            var stereoscopic = null;

            // See https://github.com/mrdoob/three.js/blob/master/examples/webgl_panorama_equirectangular.html
            (function(id, path) {

                var deg2rad = Math.PI / 180;

                var camera, scene, renderer;
                var isUserInteracting = false,
                    onMouseDownMouseX = 0, onMouseDownMouseY = 0,
                    lon = 0, onMouseDownLon = 0,
                    lat = 0, onMouseDownLat = 0,
                    phi = 0, theta = 0,
                    isAnimating = true,
                    isStereoscopic = false;
                init();
                animate();
                function init() {
                    var container, mesh;
                    container = document.getElementById(id);
                    camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 1100 );
                    camera.target = new THREE.Vector3( 0, 0, 0 );
                    scene = new THREE.Scene();
                    var geometry = new THREE.SphereBufferGeometry( 500, 60, 40 );
                    // invert the geometry on the x-axis so that all of the faces point inward
                    geometry.scale( - 1, 1, 1 );
                    var texture = new THREE.TextureLoader().load(path);
                    var material = new THREE.MeshBasicMaterial( { map: texture } );
                    mesh = new THREE.Mesh( geometry, material );
                    mesh.rotation.x = THREE.Math.degToRad( 90 );
                    scene.add( mesh );
                    renderer = new THREE.WebGLRenderer();
                    renderer.setPixelRatio( window.devicePixelRatio );
                    var element = renderer.domElement;
                    container.appendChild( element );
                    element.addEventListener( 'mousedown', onPointerStart, { passive: false } );
                    window.addEventListener( 'mousemove', onPointerMove, { passive: false } );
                    window.addEventListener( 'mouseup', onPointerUp, { passive: false } );
                    element.addEventListener( 'touchstart', onPointerStart, { passive: false } );
                    window.addEventListener( 'touchmove', onPointerMove, { passive: false } );
                    window.addEventListener( 'touchend', onPointerUp, { passive: false } );
                    window.addEventListener( 'resize', onWindowResize, false );

                    stereoscopic = function() {
                        isStereoscopic = true;
                        // document.getElementById(id).requestFullscreen();
                        if (window.DeviceOrientationEvent &&
                            typeof(window.DeviceOrientationEvent.requestPermission) === "function") {
                            window.DeviceOrientationEvent.requestPermission().then(function() {
                                window.addEventListener("deviceorientation", function(e) {
                                    camera.eulerOrder = "ZXY";
                                    // camera.eulerOrder = "XYZ";
                                    camera.rotation.set (
                                        !e.beta  ? 0 : THREE.Math.degToRad( e.beta ),
                                        !e.gamma ? 0 : THREE.Math.degToRad( e.gamma ),
                                        !e.alpha ? 0 : THREE.Math.degToRad( e.alpha ),
                                    );
                                    // camera.rotation.set (
                                    //     !e.alpha ? 0 : THREE.Math.degToRad( e.alpha ),
                                    //     !e.beta  ? 0 : THREE.Math.degToRad( e.beta ),
                                    //     !e.gamma ? 0 : THREE.Math.degToRad( e.gamma ),
                                    // );
                                    renderer.render( scene, camera );
                                }, false);
                            });
                        }
                    }

                    onWindowResize();
                }
                function onWindowResize() {
                    // Prefer a 4:3 aspect ratio
                    var aspect = 4 / 3;
                    var width = renderer.domElement.parentElement.clientWidth;
                    var height = width / aspect;
                    camera.aspect = aspect;
                    camera.updateProjectionMatrix();
                    renderer.setSize( width, height );
                }
                function onPointerStart( event ) {
                    isUserInteracting = true;
                    isAnimating = false;
                    var clientX = event.clientX || event.touches[ 0 ].clientX;
                    var clientY = event.clientY || event.touches[ 0 ].clientY;
                    onMouseDownMouseX = clientX;
                    onMouseDownMouseY = clientY;
                    onMouseDownLon = lon;
                    onMouseDownLat = lat;
                    event.preventDefault();
                }
                function onPointerMove( event ) {
                    if ( isUserInteracting === true ) {
                        var clientX = event.clientX || event.touches[ 0 ].clientX;
                        var clientY = event.clientY || event.touches[ 0 ].clientY;
                        lon = ( onMouseDownMouseX - clientX ) * 0.1 + onMouseDownLon;
                        lat = ( clientY - onMouseDownMouseY ) * 0.1 + onMouseDownLat;
                        event.preventDefault();
                    }
                }
                function onPointerUp() {
                    isUserInteracting = false;
                }
                function animate() {
                    requestAnimationFrame( animate );
                    update();
                }
                function update() {
                    if ( isStereoscopic ) {
                        return;
                    }
                    if ( isUserInteracting === false && isAnimating === true ) {
                        lon += 0.1;
                    }
                    lat = Math.max( - 85, Math.min( 85, lat ) );
                    phi = THREE.Math.degToRad( 90 - lat );
                    theta = THREE.Math.degToRad( lon );
                    camera.target.x = 500 * Math.sin( phi ) * Math.cos( theta );
                    camera.target.y = 500 * Math.cos( phi );
                    camera.target.z = 500 * Math.sin( phi ) * Math.sin( theta );
                    camera.lookAt( camera.target );
                    renderer.render( scene, camera );
                }

            })('1234', '603822945.523954.jpeg');
        </script>
        <a href="javascript:stereoscopic()">Stereoscopic<a>
    </body>
</html>
